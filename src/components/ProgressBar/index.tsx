'use client'

import { useEffect, useState } from 'react';
import { useTheme } from 'next-themes';

export default function ProgressBar() {
  const [progress, setProgress] = useState(0);
  const [mounted, setMounted] = useState(false);
  const { resolvedTheme } = useTheme();
  
  const paths = {
    light: {
            shape: `m 48.633104,3.973388 c -2.004355,0.3961667 0.731904,10.628988 -5.603267,17.652977 -4.611634,
                    5.113053 -7.808512,8.119932 -12.189845,11.310646 -4.403711,3.207011 -14.741882,10.815773 -14.611369,
                    19.906981 0.08107,5.647123 7.743153,13.697305 11.723234,16.937114 4.036621,3.285832 9.693598,
                    8.575081 12.473926,8.810165 2.090284,0.176738 1.009336,-2.029993 2.872197,-1.745624 2.259947,
                    0.526504 3.048294,1.271366 3.306913,2.793303 0.258619,1.521936 -0.684986,0.745558 -3.455763,
                    0.366576 -2.567606,-0.351192 -2.586417,2.309379 -3.894889,1.870233 -1.308472,-0.439146 -3.353152,
                    -1.819871 -4.847314,-3.69333 -2.145035,-2.689559 -3.785487,-3.88633 -5.833445,-4.534286 -4.095121,
                    -1.295661 -10.784625,1.330179 -14.764666,2.417709 -3.9800413,1.08753 -11.0873783,3.285358 -11.1037419,
                    7.670476 -0.016364,4.385118 8.5359099,7.338354 11.7046429,8.588839 3.234503,1.276441 8.211711,3.192411 12.172129,
                    3.211845 4.18308,0.02052 5.468817,-2.766696 7.725858,-5.822399 1.610471,-2.180341 2.083993,-2.619325 3.754091,
                    -2.825809 2.60353,-0.32189 6.042103,2.225854 1.484771,3.472701 -4.557332,1.246846 -6.135892,4.33413 -6.885538,
                    7.091077 -0.749646,2.756948 -1.117452,4.734488 2.726027,16.674088 1.297839,4.03168 3.592865,10.49476 8.152468,
                    10.51935 4.559603,0.0246 7.002603,-6.01265 8.1521,-10.34639 3.629929,-13.68525 4.08627,-16.56623 1.658064,
                    -18.369785 -2.920917,-2.169517 -7.269378,-5.499714 -6.242401,-6.759926 1.131813,-1.388858 2.757472,0.453782 4.120989,
                    1.834135 1.082184,1.095546 9.373682,10.880256 8.385656,17.367866 -1.046923,6.87435 -2.704204,10.39203 -12.591183,
                    28.01704 -9.88698,17.62501 -11.099385,21.46106 -11.468873,27.45662 -0.656551,10.65363 9.944939,32.74828 13.923232,
                    45.70952 5.463607,17.80037 -11.671289,75.54558 -7.352978,75.23211 4.318311,-0.31347 11.517983,-43.24224 11.4503,
                    -70.04551 -0.03307,-13.09611 -13.263463,-24.78969 -12.955947,-50.55912 0.197072,-16.51442 16.736801,-39.62262 22.05906,
                    -50.56742 5.322259,-10.9448 -10.644696,-22.358337 -13.953457,-27.691676 -3.308761,-5.333339 3.060594,-3.915429 5.427256,
                    -1.137007 2.366661,2.778421 3.823732,4.878771 5.78869,6.910718 3.704612,3.830909 10.859482,0.935795 15.199322,-1.036527 6.397231,
                    -2.907347 13.750913,-6.27562 13.930758,-8.914721 0.269097,-3.948808 -8.837527,-7.468188 -13.009397,-9.515862 -3.486168,
                    -1.711113 -8.073567,-4.701981 -12.16137,-4.055362 -4.087804,0.646619 -5.805636,5.506701 -9.238505,8.174897 -4.399406,
                    3.419436 -5.626237,1.168106 -8.128487,0.388411 C 42.245857,75.40237 58.633661,67.82796 58.780988,62.532359 58.928314,
                    57.236758 55.285869,47.323365 54.796718,45.910619 53.391313,41.851582 51.6257,34.633711 46.435427,34.358815 41.220061,
                    34.082589 38.346388,42.37617 36.361698,46.463953 c -1.686208,3.47301 -7.136025,13.723895 -5.405902,17.956453 1.569881,
                    3.840543 8.94502,8.524753 7.262312,10.146933 C 36.000809,76.70488 19.658252,60.122451 19.695043,52.707896 19.725793,
                    46.510756 25.20159,41.017864 34.7498,32.440125 45.547133,22.740223 47.545543,20.128009 49.970099,14.182395 52.185643,
                    8.74933 50.637459,3.5772213 48.633104,3.973388 Z m -2.367843,32.439215 c 3.145695,-0.06129 4.588067,1.447648 7.093014,
                    9.7209 2.512165,8.297091 4.062475,12.817502 3.665164,16.087369 -0.397311,3.269867 -4.347168,5.42526 -6.975189,7.681114 -2.628021,
                    2.255854 -6.053919,4.263994 -8.327227,4.052572 -2.273307,-0.211422 0.404318,-1.881495 -2.220662,-4.732543 -2.62498,
                    -2.851023 -4.101758,-2.498569 -5.952534,-5.825965 -1.69761,-3.052029 1.582537,-9.399096 4.635836,-17.169937 3.408699,
                    -8.675359 4.935903,-9.752218 8.081598,-9.81351 z M 65.182801,69.8443 c 2.718845,-0.09768 6.595604,2.138658 9.923936,
                    3.642461 10.729878,4.847961 11.804269,5.999086 11.873124,7.940768 0.0685,1.931597 -1.329493,2.367948 -10.737021,
                    6.952015 -3.342155,1.628553 -12.05729,5.255305 -14.467783,2.360517 -2.419996,-2.9062 -3.24219,-4.299473 -5.231986,
                    -6.458224 -1.989796,-2.158751 -3.296716,-3.389539 -2.417215,-4.316637 0.879501,-0.927098 2.224917,0.176166 3.745704,
                    -1.509387 1.520787,-1.685554 4.592397,-8.513832 7.311241,-8.611513 z m -37.855057,5.473839 c 3.352584,0.869398 4.096328,
                    1.686581 6.55222,4.628698 1.549711,1.856529 4.013463,3.171751 4.054885,4.294984 0.04142,1.123233 -1.677798,1.903722 -3.260102,
                    1.52889 -5.351128,-1.26763 -1.121941,8.616574 -9.128554,7.831327 -2.566302,-0.25169 -5.75014,-0.599572 -8.654747,-1.788395 C 8.9656649,
                    88.569711 4.5734371,86.235866 4.8501514,83.72725 5.1268657,81.218633 7.6666262,79.583695 15.403569,77.187775 c 3.60454,-1.116227 8.689077,
                    -2.708566 11.924175,-1.869636 z m 15.608437,6.876344 c 1.338743,-0.298494 2.38364,-0.351323 2.994386,0.805522 0.610745,1.156846 -0.614306,
                    4.29864 -1.961496,4.265572 -1.34719,-0.03307 -3.64216,-2.468771 -3.649014,-3.248416 -0.0069,-0.779645 1.59198,-1.594329 2.616124,
                    -1.822678 z m 8.04962,29.139847 c -1.124519,4.08818 -3.928997,11.41656 -7.292539,11.52348 -3.363542,0.10692 -5.751937,-5.18314 -6.887502,
                    -9.05927 -3.315183,-11.31603 -4.11764,-15.23986 0.42543,-19.237079 3.482094,-3.063719 6.716201,-3.943696 8.063629,-2.874115 1.347428,
                    1.069582 0.006,3.02402 3.639053,4.464142 3.633032,1.440121 5.152586,3.910432 2.051929,15.182842 z`,
            guide: `M 49.222055,3.1660445 C 50.507303,10.726339 47.361942,19.674049 41.16995,25.205933 28.211366,37.85828 19.513236,40.835555 18.165849,
            51.035275 16.818462,61.234995 36.221173,77.447238 40.229226,76.317552 45.741323,74.863428 55.164356,68.053963 58.267378,62.582599 57.719232,
            51.211697 51.10091,33.833876 45.634433,35.031403 40.167955,36.22893 31.790645,56.302624 31.70412,63.493705 37.627245,74.41797 55.153483,
            81.842918 62.61512,92.899723 71.882546,94.134801 88.270501,83.584253 88.380702,81.24295 88.490904,78.901646 73.441572,69.954278 64.604053,
            68.902889 46.97556,82.771126 41.840292,90.32672 33.632122,97.060215 c -3.10331,9.454175 5.927219,26.698575 10.78226,26.623715 4.85504,
            -0.0749 8.770678,-15.26759 9.240685,-25.31807 C 44.742408,89.86213 38.808564,82.80818 28.658045,74.389711 20.351147,74.65771 3.6651493,
            77.86944 3.9946313,84.114506 4.3241133,90.359572 27.319368,96.651733 30.163028,94.018117 34.365583,83.324619 41.42294,83.726444 44.833262,
            79.489944 c 1.829009,10.748412 17.691963,16.182243 17.088126,30.994786 -13.522125,26.16201 -19.847605,36.15285 -23.795162,54.09494 -0.642112,
            21.45171 12.879659,34.69602 14.53498,54.18967 -2.125336,21.99891 -6.358459,48.14647 -11.053303,69.26163`
            },
    dark: {
            shape: `m 29.960547,71.28737 c 4.45435,3.152949 6.834986,4.999225 10.240234,11.662239 1.081533,-1.66571 2.971994,-4.073218 4.259921,-4.087929 1.287926,
                    -0.01471 2.215025,0.801801 2.765232,1.449487 0.38391,0.451926 0.677385,1.378782 0.644745,2.192328 -0.03264,0.813546 -0.598581,1.212141 -1.690354,
                    0.855996 -1.091773,-0.356145 -1.940194,-2.588725 -1.940194,-2.588725 0,0 -2.219718,4.297246 -4.338439,4.183921 -2.11872,-0.113325 -5.814683,
                    -5.580405 -8.042855,-9.10692 -9.395657,3.211558 -19.197989,5.814782 -28.8148919,7.899304 9.4950889,2.658204 18.5450129,6.880742 27.6812409,
                    10.376288 3.919678,-4.44733 6.928294,-6.425824 8.814606,-6.412118 1.886312,0.01371 2.67109,1.264669 2.23533,2.668377 -0.435759,1.403708 -4.48811,
                    4.636423 -7.2045,6.245971 2.843939,5.945881 6.539543,21.590171 8.836735,33.538591 2.410503,-11.52463 5.889808,-24.09481 8.655549,-33.77711 -2.644768,
                    -2.069151 -6.271413,-5.128005 -6.20276,-6.452295 0.06865,-1.32429 0.837327,-2.162861 2.072523,-2.027087 1.235196,0.135774 5.160132,6.052702 5.897438,
                    12.553472 0.737306,6.50077 -12.807339,50.44999 -12.807339,50.44999 8.711243,50.50834 6.716626,92.73304 3.377918,135.62077 0,0 3.115623,
                    -48.55304 6.958837,-68.12199 -5.231125,-19.60832 -6.603854,-54.27601 -6.240558,-67.30752 0.348421,-12.49796 10.374737,-50.0494 12.925956,
                    -55.516342 -2.976562,-0.969573 -6.943316,-5.09408 -7.95625,-8.123027 -1.012934,-3.028947 -0.752206,-2.948429 0.765105,-2.90601 1.517311,
                    0.04242 4.006982,4.374506 5.714665,7.509337 4.292215,-2.91584 30.460467,-8.332801 30.460467,-8.332801 0,0 -28.019527,-6.818388 -30.331522,
                    -9.343383 -2.371149,3.165689 -4.134123,5.663228 -5.120532,5.701994 -0.986409,0.03877 -2.216265,0.129986 -2.850529,-0.70562 -0.789286,
                    -1.039839 -0.514256,-2.445845 -0.366478,-3.23036 0.147778,-0.784515 2.670775,-3.997606 5.568455,-6.004416 -3.204303,-9.020176 -5.658859,
                    -20.814342 -7.36241,-31.344985 -2.818582,10.466265 -5.818531,21.00472 -10.290707,31.027759 1.460244,1.767036 6.20918,5.890128 6.297904,
                    7.173464 0.08872,1.283336 -0.817362,1.490701 -1.660226,1.323453 C 40.069999,78.164225 37.216902,75.764045 34.993139,69.689106 32.769376,
                    63.614167 44.12407,34.743689 48.05746,29.129032 45.320121,25.367668 42.956058,4.1560557 42.956058,4.1560557 c 0,0 1.923317,20.6054473 1.194,
                    25.7394483 C 43.420741,35.029505 30.75288,71.575491 29.960547,71.28737 Z M 45.665295,53.96432 c 1.443536,0.05373 3.902501,11.315653 4.179271,
                    14.693486 0.27677,3.377833 -3.737016,6.376445 -5.218051,6.300116 -1.481035,-0.07633 -4.60176,-3.251192 -4.5497,-6.497922 0.05206,-3.24673 4.144944,
                    -14.549411 5.58848,-14.49568 z m 13.042778,24.652347 c 2.479737,-0.01305 15.18149,3.058834 15.067895,4.547609 -0.113595,1.488775 -12.106352,
                    4.441761 -14.978311,4.185072 -2.871959,-0.256689 -5.016263,-2.811106 -5.030811,-4.467458 -0.01455,-1.656352 2.46149,-4.252178 4.941227,
                    -4.265223 z m -27.74998,1.822577 c 4.300272,1.017817 4.751249,3.751471 4.654801,5.366874 -0.09645,1.615403 -2.016137,3.631028 -5.729176,
                    4.024822 -3.713039,0.393794 -15.230943,-3.756218 -15.026304,-5.977529 0.204639,-2.221311 11.800407,-4.431984 16.100679,-3.414167 z m 13.188391,
                    3.812809 c 1.345617,-0.03965 2.009513,0.968167 1.999692,2.079617 -0.0098,1.111449 -0.938532,1.963163 -1.947832,2.017373 -1.0093,0.05421 -2.130784,
                    -1.072948 -2.124795,-2.036803 0.006,-0.963855 0.727318,-2.020541 2.072935,-2.060187 z m -0.499692,7.652343 c 2.035095,-0.09428 4.463828,2.058133 4.465976,
                    5.753598 0.0021,3.695466 -1.651015,15.648566 -4.529174,15.561526 -2.878159,-0.087 -4.506432,-13.10516 -4.413365,-15.723119 0.09307,-2.617958 2.441469,
                    -5.497725 4.476563,-5.592005 z`,
            guide: `m 42.843304,4.1159506 3.17386,25.3344654 C 41.088301,42.08198 36.426377,54.456813 32.530729,70.532428 l 7.786878,9.541521 c 4.524667,-2.68841 8.384815,
                    -4.981474 11.693041,-10.196333 -1.601193,-6.555941 -3.962687,-14.775926 -5.667457,-23.18019 -2.471655,6.880388 -6.441471,15.542762 -8.083558,22.993103 1.426239,
                    4.52017 13.024173,11.368805 18.708865,19.64431 8.799699,-1.638838 14.746888,-3.848178 21.982919,-5.799749 -6.896377,-2.345483 -12.864767,-5.309625 -21.702286,
                    -6.361014 -8.776717,5.582701 -12.510314,12.367652 -20.11203,19.737853 1.994548,10.596701 3.865475,16.543941 6.267469,25.292961 2.6877,-8.85217 5.34799,
                    -15.65123 6.92228,-25.573594 C 45.679669,90.523807 39.223017,85.236354 31.430896,78.390151 23.123998,78.65815 16.284006,81.848263 9.3184393,84.119052 16.864786,
                    86.500346 22.862147,90.5244 29.437118,91.938029 c 6.406187,-6.156984 11.990335,-4.632745 14.99644,-9.057751 4.527973,3.097283 7.352763,9.237275 11.109079,
                    13.789766 -3.394352,18.962746 -10.329939,43.230096 -12.325154,54.216966 -0.642112,26.57661 4.216142,44.82379 5.993484,67.36797 l -4.964498,70.70346`
          }
  };
    
  useEffect(() => {
    const updateProgress = () => {
      const scrolled = window.scrollY;
      const total = document.documentElement.scrollHeight - window.innerHeight;
      setProgress((scrolled / total) * 100);
    };

    setMounted(true);
    updateProgress();
    window.addEventListener('scroll', updateProgress);
    return () => window.removeEventListener('scroll', updateProgress);
  }, []);

  if (!mounted) return null;

  const current = resolvedTheme === 'dark' ? paths.dark : paths.light;

  return (
      <svg viewBox="0 0 92 294" className="w-full h-auto max-h-[500px]" preserveAspectRatio="xMidYMid meet">      <defs>
        <filter id="glow">
          <feGaussianBlur stdDeviation="0.5" result="coloredBlur"/>
          <feMerge>
            <feMergeNode in="coloredBlur"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
        <mask id="progress-mask">
          <rect width="100%" height="100%" fill="black"/>
          <path
            d={current.guide}
            stroke="white"
            strokeWidth="5"
            strokeLinecap="round"
            pathLength="100"
            strokeDasharray="100"
            strokeDashoffset={100 - progress}
            fill="none"
          />
        </mask>
      </defs>

      <path d={current.shape} fill="var(--dim)" className="opacity-20"/>
      <path d={current.shape} fill="var(--foreground)" filter="url(#glow)" mask="url(#progress-mask)"/>
    </svg>
  );
}